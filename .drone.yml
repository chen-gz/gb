---
kind: pipeline
type: exec
name: default

platform:
  os: linux
  arch: amd64

steps:
  - name: greeting
    commands:
      - export PROJECT_NAME=$(git config --local remote.origin.url | tr '/' '\n' | tail -1)
      - export BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
      - export BINARY_FOLDER_PATH=/home/zong/blog

#       build front-end
      - cd front_end
      - yarn install
      - yarn build
      - cd ..
      - go build .
  # create gitea release
  - name: create release
    environment:
      GITEA_TOKEN:
        from_secret: gitea_token
    commands:
      - export GITEA_NAME=gitea.ggeta.com
      - export BUILD_TIME=$(date +%Y-%m-%d-%H-%M-%S)
      # login use tea
      - echo $GITEA_NAME
      - echo $GITEA_URL$GITEA_NAME
      - echo $GITEA_TOKEN
      - tea login add --token $GITEA_TOKEN --url=https://$GITEA_NAME
      # set as default
      - tea login default $GITEA_NAME
      # create release
      - tea r create --title=auto release --tag {$BUILD_TIME} --assets gb_blog
