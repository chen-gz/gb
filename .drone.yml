---
kind: pipeline
type: exec
name: default

platform:
  os: linux
  arch: amd64

steps:
  - name: greeting
    commands:
      - export PROJECT_NAME=$(git config --local remote.origin.url | tr '/' '\n' | tail -1)
      - export BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
      - export BINARY_FOLDER_PATH=/home/zong/blog

      # build front-end
      - cd front_end
      - yarn install
      - yarn build
      - cd ..
      - go build .
  # create gitea release
  - name: create realse
    environment:
      GITEA_NAME:
        from_secret: GITEA_NAME
      GITEA_TOKEN:
        from_secret: GITEA_TOKEN
    commands:
      - export GITEA_URL=http://
      - export BUILD_TIME=$(date +%Y%m%d%H%M%S)
      # login use tea
      - tea login --token $GITEA_TOKEN --url ${GITEA_URL}$GITEA_NAME
      # set as default
      - tea login default $GITEA_NAME
      # create release
      - tea r create --title=auto release --tag ${BUILD_TIME} --assets gb_blog
